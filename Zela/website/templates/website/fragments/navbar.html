{% load static %}

<!-- Navbar Container with Alpine.js Data -->
<div x-data="{ mobileMenuOpen: false }" class="relative">
  <!-- Header with Logo and Navigation -->
  <header
    class="w-full flex items-center justify-between px-4 md:px-6 lg:px-8 py-4 mx-auto max-w-[1280px] z-20 relative"
    @click.away="mobileMenuOpen = false"
  >
    <!-- Logo -->
    <div class="flex items-center">
      <a href="/" class="flex items-center">
        <img
          src="{% static 'zela-logo.png' %}"
          alt="Zela"
          class="h-10 md:h-12 w-auto"
        />
      </a>
    </div>

    <!-- Navigation Links -->
    <nav class="hidden md:flex items-center gap-8">
      <a
        href="/about/"
        class="text-muted-foreground hover:text-primary transition-colors font-medium"
      >
        Sobre
      </a>
      <a
        href="/services/"
        class="text-muted-foreground hover:text-primary transition-colors font-medium"
      >
        Serviços
      </a>
      <a
        href="/pricing/"
        class="text-muted-foreground hover:text-primary transition-colors font-medium"
      >
        Preços
      </a>
      <a
        href="/contact/"
        class="text-muted-foreground hover:text-primary transition-colors font-medium"
      >
        Contacto
      </a>
    </nav>

    <!-- User Authentication Section -->
    <div class="hidden md:flex items-center gap-4">
      {% if user.is_authenticated %}
      <!-- User Profile Dropdown -->
      <div class="relative" x-data="{ open: false }">
        <button
          @click="open = !open"
          @click.away="open = false"
          class="flex items-center gap-3 p-2 rounded-full hover:bg-muted transition-colors"
        >
          <!-- Avatar -->
          <div
            class="w-10 h-10 rounded-full bg-primary flex items-center justify-center"
          >
            <span class="text-white font-semibold text-sm">
              {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
            </span>
          </div>
          <!-- User Name -->
          <span class="text-muted-foreground font-medium hidden sm:block">
            {{ user.first_name }} {{ user.last_name }}
          </span>
          <!-- Dropdown Arrow -->
          <svg
            class="w-4 h-4 text-muted-foreground transition-transform"
            :class="{ 'rotate-180': open }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </button>

        <!-- Dropdown Menu -->
        <div
          x-show="open"
          x-transition:enter="transition ease-out duration-100"
          x-transition:enter-start="transform opacity-0 scale-95"
          x-transition:enter-end="transform opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-75"
          x-transition:leave-start="transform opacity-100 scale-100"
          x-transition:leave-end="transform opacity-0 scale-95"
          class="absolute right-0 mt-2 w-48 bg-card rounded-md shadow-lg py-1 z-50 border border-border"
        >
          <a
            href="{% url 'website:dashboard' %}"
            class="block px-4 py-2 text-sm text-muted-foreground hover:bg-muted transition-colors cursor-pointer"
          >
            Painel de Controlo
          </a>
          <a
            href="{% url 'website:dashboard' %}?tab=profile"
            class="block px-4 py-2 text-sm text-muted-foreground hover:bg-muted transition-colors cursor-pointer"
          >
            Perfil
          </a>
          <a
            href="{% url 'website:dashboard' %}?tab=settings"
            class="block px-4 py-2 text-sm text-muted-foreground hover:bg-muted transition-colors cursor-pointer"
          >
            Configurações
          </a>
          <hr class="my-1 border-border" />
          <form
            method="post"
            action="{% url 'accounts:logout' %}"
            class="block"
          >
            {% csrf_token %}
            <button
              type="submit"
              class="w-full text-left px-4 py-2 text-sm text-muted-foreground hover:bg-muted transition-colors cursor-pointer"
            >
              Sair
            </button>
          </form>
        </div>
      </div>
      {% else %}
      <!-- Login/Signup Buttons -->
      <a
        href="{% url 'website:sign-in' %}"
        class="border border-primary text-primary px-6 py-2 rounded-full font-semibold hover:bg-primary hover:text-primary-foreground transition-colors"
      >
        Entrar
      </a>
      <a
        href="{% url 'website:register' %}"
        class="bg-primary text-primary-foreground px-6 py-2 rounded-full font-semibold hover:bg-primary/90 transition-colors shadow-lg"
      >
        Registar
      </a>
      {% endif %}
    </div>

    <!-- Mobile Menu and User Section -->
    <div class="flex md:hidden items-center gap-2">
      {% if user.is_authenticated %}
      <!-- Mobile User Avatar -->
      <div
        class="w-8 h-8 rounded-full bg-primary flex items-center justify-center"
      >
        <span class="text-white font-semibold text-xs">
          {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
        </span>
      </div>
      {% else %}
      <!-- Mobile Login Button -->
      <a
        href="{% url 'website:sign-in' %}"
        class="text-primary text-sm font-semibold px-3 py-1"
      >
        Entrar
      </a>
      {% endif %}

      <!-- Mobile Menu Button -->
      <button
        @click.stop="mobileMenuOpen = !mobileMenuOpen"
        class="p-2 rounded-lg hover:bg-muted transition-colors cursor-pointer"
        :aria-expanded="mobileMenuOpen"
        aria-label="Toggle navigation menu"
        type="button"
      >
        <svg
          x-show="!mobileMenuOpen"
          class="w-6 h-6 text-muted-foreground"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
        <svg
          x-show="mobileMenuOpen"
          x-cloak
          class="w-6 h-6 text-muted-foreground"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>
  </header>

  <!-- Mobile Menu Content - Overlay -->
  <div
    x-show="mobileMenuOpen"
    x-cloak
    class="absolute top-full left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50 md:hidden"
    x-transition:enter="transition ease-out duration-500"
    x-transition:enter-start="opacity-0 transform -translate-y-4"
    x-transition:enter-end="opacity-100 transform translate-y-0"
    x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="opacity-100 transform translate-y-0"
    x-transition:leave-end="opacity-0 transform -translate-y-4"
    @click.away="mobileMenuOpen = false"
  >
    <!-- Mobile Menu Content -->
    <div class="px-4 md:px-6 lg:px-8 py-6">
      <!-- Mobile Navigation Links -->
      <nav class="mb-6">
        <div class="space-y-2">
          <a
            href="/about/"
            @click="mobileMenuOpen = false"
            class="block px-4 py-4 text-lg font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors"
          >
            Sobre
          </a>
          <a
            href="/services/"
            @click="mobileMenuOpen = false"
            class="block px-4 py-4 text-lg font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors"
          >
            Serviços
          </a>
          <a
            href="/pricing/"
            @click="mobileMenuOpen = false"
            class="block px-4 py-4 text-lg font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors"
          >
            Preços
          </a>
          <a
            href="/contact/"
            @click="mobileMenuOpen = false"
            class="block px-4 py-4 text-lg font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors"
          >
            Contacto
          </a>
        </div>
      </nav>

      <!-- Mobile User Section -->
      <div class="border-t border-gray-200 pt-4">
        {% if user.is_authenticated %}
        <!-- User Info -->
        <div class="flex items-center gap-3 mb-4">
          <div
            class="w-12 h-12 rounded-full bg-primary flex items-center justify-center"
          >
            <span class="text-white font-semibold text-sm">
              {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
            </span>
          </div>
          <div>
            <div class="font-semibold text-gray-900 text-lg">
              {{ user.first_name }} {{ user.last_name }}
            </div>
            <div class="text-sm text-gray-600">{{ user.email }}</div>
          </div>
        </div>

        <!-- User Links -->
        <div class="space-y-2">
          <a
            href="{% url 'website:dashboard' %}"
            @click="mobileMenuOpen = false"
            class="block px-4 py-3 text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors font-medium"
          >
            Painel de Controlo
          </a>
          <a
            href="{% url 'website:dashboard' %}?tab=profile"
            @click="mobileMenuOpen = false"
            class="block px-4 py-3 text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors font-medium"
          >
            Perfil
          </a>
          <a
            href="{% url 'website:dashboard' %}?tab=settings"
            @click="mobileMenuOpen = false"
            class="block px-4 py-3 text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors font-medium"
          >
            Configurações
          </a>
          <form method="post" action="{% url 'accounts:logout' %}" class="mt-4">
            {% csrf_token %}
            <button
              type="submit"
              class="w-full text-left px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors font-medium"
            >
              Sair
            </button>
          </form>
        </div>
        {% else %}
        <!-- Login/Signup Buttons - Same as Desktop but Scaled Up -->
        <div class="flex flex-col gap-3">
          <a
            href="{% url 'website:sign-in' %}"
            @click="mobileMenuOpen = false"
            class="border border-primary text-primary px-8 py-3 rounded-full font-semibold hover:bg-primary hover:text-primary-foreground transition-colors text-center text-lg"
          >
            Entrar
          </a>
          <a
            href="{% url 'website:register' %}"
            @click="mobileMenuOpen = false"
            class="bg-primary text-primary-foreground px-8 py-3 rounded-full font-semibold hover:bg-primary/90 transition-colors shadow-lg text-center text-lg"
          >
            Registar
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Add cloak styles for Alpine.js -->
  <style>
    [x-cloak] {
      display: none !important;
    }
  </style>
</div>
<!-- End Navbar Container -->
