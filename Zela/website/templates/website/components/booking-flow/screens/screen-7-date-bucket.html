{% load static %}
<!-- Screen 7: Choose Date Bucket -->
<div class="min-h-screen bg-white flex flex-col">
  <!-- Progress Header -->
  {% include "website/components/booking-flow/partials/booking-progress-header.html" %}

  <!-- Main Content with Sticky Sidebar -->
  <div class="flex flex-col lg:flex-row flex-1 max-w-7xl mx-auto w-full">
    <!-- Sticky Left Column - Booking Details -->
    <div
      class="w-full lg:w-80 lg:flex-shrink-0 lg:sticky lg:top-0 lg:h-screen overflow-y-auto px-4 sm:px-6 py-4 sm:py-6 lg:py-8 space-y-4 sm:space-y-6 border-b lg:border-b-0 lg:border-r border-gray-200"
    >
      <!-- Booking Summary -->
      <div class="bg-white border border-gray-200 rounded-2xl p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-bold mb-3 sm:mb-4" style="color: #011e41">
          Detalhes da Reserva
        </h3>
        <!-- Pricing Display -->
        <div class="bg-[#F4D35E] text-[#011e41] rounded-2xl p-5">
          <div class="space-y-4">
            <!-- Hours Row -->
            <div class="pb-3 border-b border-[#011e41]/20">
              <div class="text-2xl font-bold mb-1">
                <span x-text="booking.details.duration"></span> Horas
              </div>
              <div class="text-sm text-[#011e41]/70">Horas Est.</div>
            </div>
            <!-- Price Row -->
            <div>
              <div class="text-2xl font-bold mb-1" x-text="formatCurrency(booking.pricing.bookingCost)"></div>
              <div class="text-sm text-[#011e41]/70">Preço Est.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Location & Service Details -->
      <div class="bg-white border border-gray-200 rounded-2xl p-4 sm:p-6">
        <!-- Location -->
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-sm text-gray-600 mb-1">Onde:</div>
            <div
              class="text-sm font-medium"
              style="color: #011e41"
              x-text="booking.location.streetAddress.substring(0, 30) + (booking.location.streetAddress.length > 30 ? '...' : '')"
            ></div>
          </div>
          <button
            @click="goToScreen(1)"
            class="text-gray-400 hover:text-gray-600 cursor-pointer transition-colors"
            title="Edit location"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>
        </div>

        <!-- Service Type -->
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm text-gray-600 mb-1">O quê:</div>
            <div
              class="text-sm font-medium"
              style="color: #011e41"
              x-text="'{{ service_name|default:'Limpeza Interior' }}'"
            ></div>
          </div>
          <button
            @click="alert('O tipo de serviço não pode ser alterado nesta fase. Por favor, inicie uma nova reserva.')"
            class="text-gray-400 hover:text-gray-600 cursor-pointer transition-colors"
            title="Service type cannot be changed"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Service Info -->
      <div class="bg-white border border-gray-200 rounded-2xl p-4 sm:p-6 text-center">
        <div
          class="w-20 h-20 bg-[#015e73] rounded-full mx-auto mb-4 flex items-center justify-center"
        >
          <svg
            class="w-10 h-10 text-white"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M19.36 2.72L20.78 4.14L15.06 9.85C16.13 11.39 16.28 13.24 15.38 14.44L9.06 8.12C10.26 7.22 12.11 7.37 13.65 8.44L19.36 2.72M5.93 17.57C3.92 15.56 2.69 13.16 2.35 10.92L7.23 8.83L14.67 16.27L12.58 21.15C10.34 20.81 7.94 19.58 5.93 17.57Z"
            />
          </svg>
        </div>
        <div class="text-lg font-bold mb-2" style="color: #011e41">{{ service_name|default:"Limpeza Interior" }}
        </div>
        <div class="text-sm text-gray-600 mb-4 leading-relaxed">{{ service_description|default:"Obtenha 3,5 a 10 horas de limpeza completa e abrangente da sua casa." }}
        </div>
        <button
          @click="showServiceScope = true"
          class="text-[#015e73] font-medium text-sm hover:text-[#014a5a] cursor-pointer"
        >
          Saiba Mais
        </button>
      </div>
    </div>

    <!-- Scrollable Right Column - Date Selection -->
    <div class="flex-1 overflow-y-auto px-4 sm:px-6 py-4 sm:py-6 lg:py-8">
      <div class="max-w-2xl">
        <h2 class="text-2xl sm:text-3xl font-bold mb-2" style="color: #011e41">
          Com que frequência precisa de ajuda?
        </h2>
        <p class="text-sm sm:text-base text-gray-600 mb-6 sm:mb-8">Com que frequência precisa do serviço?</p>

        <!-- Frequency Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-8 sm:mb-12">
          <!-- One Time (Default/Unselected) -->
          <div
            @click="selectFrequency('one-time')"
            class="bg-white border-2 border-gray-200 rounded-2xl p-4 sm:p-6 cursor-pointer hover:border-[#015e73] transition-colors duration-200"
            :class="{ 'bg-[#015e73]/10 border-[#015e73]': booking.frequency === 'one-time' }"
          >
            <div class="flex items-center mb-4">
              <div
                class="w-8 h-8 rounded-full flex items-center justify-center mr-3"
                :class="booking.frequency === 'one-time' ? 'bg-[#015e73]' : 'bg-gray-200'"
              >
                <svg
                  x-show="booking.frequency === 'one-time'"
                  class="w-4 h-4 text-white"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
              </div>
              <h3 class="text-lg font-bold" style="color: #011e41">Uma Vez</h3>
            </div>
            <p class="text-gray-600">
              Para serviços únicos que não se repetirão.
            </p>
          </div>

          <!-- Repeat -->
          <div
            @click="selectFrequency('repeat')"
            class="bg-white border-2 border-gray-200 rounded-2xl p-6 cursor-pointer hover:border-[#015e73] transition-colors duration-200 relative"
            :class="{ 'bg-[#015e73]/10 border-[#015e73]': booking.frequency === 'repeat' }"
          >
            <div
              class="absolute -top-2 -right-2 bg-[#FDEA00] text-gray-900 text-xs font-bold px-3 py-1 rounded-full"
            >
              Melhor Valor
            </div>
            <div class="flex items-center mb-4">
              <div
                class="w-8 h-8 rounded-full flex items-center justify-center mr-3"
                :class="booking.frequency === 'repeat' ? 'bg-[#015e73]' : 'bg-gray-200'"
              >
                <svg
                  x-show="booking.frequency === 'repeat'"
                  class="w-4 h-4 text-white"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                <svg
                  x-show="booking.frequency !== 'repeat'"
                  class="w-4 h-4 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                  />
                </svg>
              </div>
              <h3 class="text-lg font-bold" style="color: #011e41">Repetir</h3>
            </div>
            <p class="text-gray-600">
              Para serviços repetidos a cada poucos dias / semanas.
            </p>
          </div>
        </div>

        <!-- Date Selection -->
        <div x-show="booking.frequency">
          <h3 class="text-2xl font-bold mb-4" style="color: #011e41">
            Quando precisa de ajuda?
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- Tomorrow -->
            <div
              @click="selectDateBucket('tomorrow')"
              class="bg-white border-2 border-gray-200 rounded-2xl p-6 cursor-pointer hover:border-[#015e73] transition-colors duration-200 relative"
              :class="{ 'bg-[#015e73]/10 border-[#015e73]': booking.dateBucket === 'tomorrow' }"
            >
              <!-- Premium Badge -->
              <div
                class="absolute -top-2 -right-2 bg-[#FDEA00] text-gray-900 text-xs font-bold px-3 py-1 rounded-full"
              >
                Premium
              </div>

              <div class="text-center">
                <div class="text-lg font-bold mb-2" style="color: #011e41">
                  Amanhã
                </div>
                <div class="text-sm text-gray-600">Obter ajuda amanhã</div>
              </div>
            </div>

            <!-- Later -->
            <div
              @click="selectDateBucket('later')"
              class="bg-white border-2 border-gray-200 rounded-2xl p-4 sm:p-6 cursor-pointer hover:border-[#015e73] transition-colors duration-200"
              :class="{ 'bg-[#015e73]/10 border-[#015e73]': booking.dateBucket === 'later' }"
            >
              <div class="text-center">
                <div class="text-lg font-bold mb-2" style="color: #011e41">
                  Mais Tarde
                </div>
                <div class="text-sm text-gray-600">Obter ajuda mais tarde</div>
              </div>
            </div>

            <!-- Today (Disabled) -->
            <div
              class="bg-gray-100 border-2 border-gray-200 rounded-2xl p-6 cursor-not-allowed opacity-50"
            >
              <div class="text-center">
                <div class="text-lg font-bold mb-2 text-gray-500">Hoje</div>
                <div class="text-sm text-gray-500">Totalmente Reservado</div>
              </div>
            </div>
          </div>

          <!-- Navigation happens automatically when dateBucket is selected -->
        </div>
      </div>
    </div>
  </div>
</div>
