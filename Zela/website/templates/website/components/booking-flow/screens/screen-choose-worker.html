{% load static %}

<!-- Choose Worker Screen -->
<div class="min-h-screen bg-white flex flex-col">
  <!-- Progress Header -->
  {% include "website/components/booking-flow/partials/booking-progress-header.html" %}

  <!-- Main Content - Single scrollable page -->
  <div class="flex flex-col lg:flex-row flex-1 max-w-7xl mx-auto w-full">
    <!-- Left Column - Booking Details (not sticky) -->
    <div
      class="w-full lg:w-80 lg:flex-shrink-0 px-4 sm:px-6 py-4 sm:py-6 lg:py-8 space-y-4 sm:space-y-6 border-b lg:border-b-0 lg:border-r border-gray-200"
    >
      <!-- Booking Details -->
      <div class="bg-white border border-gray-200 rounded-2xl p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-bold mb-3 sm:mb-4" style="color: #011e41">
          Detalhes da Reserva
        </h3>

        <!-- Pricing Display -->
        <div class="bg-[#F4D35E] text-[#011e41] rounded-2xl p-5">
          <div class="space-y-4">
            <!-- Hours Row -->
            <div class="pb-3 border-b border-[#011e41]/20">
              <div class="text-2xl font-bold mb-1">
                <span x-text="booking.details.duration"></span> Horas
              </div>
              <div class="text-sm text-[#011e41]/70">Horas Est.</div>
            </div>
            <!-- Price Row -->
            <div>
              <div class="text-2xl font-bold mb-1" x-text="formatCurrency(booking.pricing.bookingCost)"></div>
              <div class="text-sm text-[#011e41]/70">Preço Est.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Location & Service Details -->
      <div class="bg-white border border-gray-200 rounded-2xl p-4 sm:p-6">
        <!-- Location -->
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-sm text-gray-600 mb-1">Onde:</div>
            <div
              class="text-sm font-medium"
              style="color: #011e41"
              x-text="booking.location.streetAddress.substring(0, 30) + (booking.location.streetAddress.length > 30 ? '...' : '')"
            ></div>
          </div>
          <button
            @click="goToScreen(1)"
            class="text-gray-400 hover:text-gray-600 cursor-pointer transition-colors"
            title="Edit location"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>
        </div>

        <!-- Service Type -->
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-sm text-gray-600 mb-1">O quê:</div>
            <div
              class="text-sm font-medium"
              style="color: #011e41"
              x-text="'{{ service_name|default:'Limpeza Interior' }}'"
            ></div>
          </div>
          <button
            @click="alert('O tipo de serviço não pode ser alterado nesta fase. Por favor, inicie uma nova reserva.')"
            class="text-gray-400 hover:text-gray-600 cursor-pointer transition-colors"
            title="Service type cannot be changed"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>
        </div>

        <!-- When -->
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm text-gray-600 mb-1">Quando:</div>
            <div class="text-sm font-medium" style="color: #011e41">
              <span
                x-text="booking.dateBucket === 'tomorrow' ? 'Amanhã' : new Date(booking.date).toLocaleDateString('pt-PT', { weekday: 'short', month: 'short', day: 'numeric' })"
              ></span>
              @ <span x-text="booking.details.startTime || '07:00'"></span>
            </div>
          </div>
          <button
            @click="goToScreen(7)"
            class="text-gray-400 hover:text-gray-600 cursor-pointer transition-colors"
            title="Edit date and time"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Choose For Me Option -->
      <div class="bg-gray-50 border border-gray-200 rounded-2xl p-5 text-center">
        <div
          class="w-16 h-16 bg-[#015e73]/10 rounded-full mx-auto mb-3 flex items-center justify-center"
        >
          <svg
            class="w-8 h-8 text-[#015e73]"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17L10.5 10.84L6.62 8.5L2 13.12L3.41 14.53L6.62 11.32L10.5 13.66L17.5 6.66L19.83 8.99L21 9ZM12.5 11C12.5 11 13 11.34 13 12.5V18.5C13 19.66 12.16 20.5 11 20.5H10C8.84 20.5 8 19.66 8 18.5V12.5C8 11.34 8.5 11 8.5 11H12.5Z"
            />
          </svg>
        </div>
        
        <div class="border-t border-gray-200 my-3"></div>
        
        <div class="text-base font-bold mb-2" style="color: #011e41">
          Escolha por mim
        </div>
        <div class="flex items-center justify-center mb-1">
          <svg
            class="w-3.5 h-3.5 text-[#015e73] mr-1"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"
            />
          </svg>
          <span class="text-xs font-medium" style="color: #011e41"
            >97% Recomendam</span
          >
        </div>
        <div class="text-xs text-gray-600 mb-3">2+ Anos de Experiência</div>
        <div class="text-xs text-gray-600 mb-4 leading-relaxed px-2">
          A nossa equipa encontrará um trabalhador que possa ajudá-lo. Fique
          atento à sua caixa de entrada.
        </div>
        <button
          @click="chooseForMe()"
          class="w-full bg-[#015e73] text-white text-sm font-medium py-2.5 px-3 rounded-xl hover:bg-[#014a5a] transition-colors cursor-pointer"
        >
          Escolher Por Mim
        </button>
      </div>
    </div>

    <!-- Right Column - Worker Selection -->
    <div class="flex-1 px-4 sm:px-6 py-4 sm:py-6 lg:py-8">
      <div class="max-w-2xl">
        <h2 class="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 text-center" style="color: #011e41">
          Escolha o seu trabalhador
        </h2>

        <!-- Worker Cards Container - Will be populated dynamically -->
        <div class="space-y-6">
          <!-- Workers will be loaded here dynamically -->
          <!-- Fallback message if no workers -->
          <div class="text-center py-8 text-gray-500">
            <div class="mb-4">
              <svg
                class="w-16 h-16 mx-auto text-gray-300"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
            </div>
            <p>A carregar trabalhadores disponíveis...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
