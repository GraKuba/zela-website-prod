{% load static %}
<!-- Services Carousel Section -->
<section class="py-24 bg-[#F5F5F5] max-w-[1280px] mx-auto" id="services">
  <div class="max-w-6xl mx-auto px-6">
    <!-- Section Heading -->
    <div class="text-center mb-16">
      <h2 class="text-5xl font-bold text-[#011E41] mb-4 leading-tight">
        Services We Offer
      </h2>
    </div>

    <!-- Carousel Container -->
    <div
      class="relative"
      x-data="servicesCarousel()"
      x-init="init()"
      @touchstart="handleTouchStart($event)"
      @touchmove="handleTouchMove($event)"
      @touchend="handleTouchEnd($event)"
    >
      <!-- Navigation Arrows (Desktop Only) -->
      <button
        @click="prevSlide()"
        class="hidden md:flex absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white rounded-full shadow-lg items-center justify-center hover:bg-gray-50 transition-colors z-10"
        :class="{'opacity-50 cursor-not-allowed': currentSlide === 0}"
        :disabled="currentSlide === 0"
        aria-label="Previous services"
      >
        <svg
          class="w-6 h-6 text-[#011E41]"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>

      <button
        @click="nextSlide()"
        class="hidden md:flex absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white rounded-full shadow-lg items-center justify-center hover:bg-gray-50 transition-colors z-10"
        :class="{'opacity-50 cursor-not-allowed': currentSlide >= maxSlide}"
        :disabled="currentSlide >= maxSlide"
        aria-label="Next services"
      >
        <svg
          class="w-6 h-6 text-[#011E41]"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>

      <!-- Carousel Track -->
      <div class="overflow-hidden">
        <div
          class="flex transition-transform duration-300 ease-out"
          :style="`transform: translateX(-${getTranslateX()}%)`"
        >
          <!-- Service Card 1: Home Cleaning -->
          <div
            class="w-4/5 max-w-xs shrink-0 bg-white rounded-2xl shadow-md text-center p-6 mx-3 md:w-1/3"
          >
            <div class="mb-6">
              <img
                src="{% static 'beatriz.webp' %}"
                alt="Home Cleaning Service"
                class="w-full h-48 object-cover rounded-xl mb-4"
                loading="lazy"
              />
            </div>
            <h3 class="text-2xl font-bold text-[#011E41] mb-2">
              Home Cleaning
            </h3>
            <p class="text-[#4A5A70] text-lg leading-relaxed">
              Quick spruce-ups or deep cleans.
            </p>
          </div>

          <!-- Service Card 2: Specialty Cleaning -->
          <div
            class="w-4/5 max-w-xs shrink-0 bg-white rounded-2xl shadow-md text-center p-6 mx-3 md:w-1/3"
          >
            <div class="mb-6">
              <img
                src="{% static 'carla.webp' %}"
                alt="Specialty Cleaning Service"
                class="w-full h-48 object-cover rounded-xl mb-4"
                loading="lazy"
              />
            </div>
            <h3 class="text-2xl font-bold text-[#011E41] mb-2">
              Specialty Cleaning
            </h3>
            <p class="text-[#4A5A70] text-lg leading-relaxed">
              Windows, carpets, post-renovation.
            </p>
          </div>

          <!-- Service Card 3: Outdoor & Garden -->
          <div
            class="w-4/5 max-w-xs shrink-0 bg-white rounded-2xl shadow-md text-center p-6 mx-3 md:w-1/3"
          >
            <div class="mb-6">
              <img
                src="{% static 'pedro.webp' %}"
                alt="Outdoor & Garden Service"
                class="w-full h-48 object-cover rounded-xl mb-4"
                loading="lazy"
              />
            </div>
            <h3 class="text-2xl font-bold text-[#011E41] mb-2">
              Outdoor & Garden
            </h3>
            <p class="text-[#4A5A70] text-lg leading-relaxed">
              Patio wash, lawn care, pool skim.
            </p>
          </div>

          <!-- Service Card 4: Trades & Repairs -->
          <div
            class="w-4/5 max-w-xs shrink-0 bg-white rounded-2xl shadow-md text-center p-6 mx-3 md:w-1/3"
          >
            <div class="mb-6">
              <img
                src="{% static 'orlando.webp' %}"
                alt="Trades & Repairs Service"
                class="w-full h-48 object-cover rounded-xl mb-4"
                loading="lazy"
              />
            </div>
            <h3 class="text-2xl font-bold text-[#011E41] mb-2">
              Trades & Repairs
            </h3>
            <p class="text-[#4A5A70] text-lg leading-relaxed">
              Handymen, plumbers, electricians.
            </p>
          </div>

          <!-- Service Card 5: Full-Time Placement -->
          <div
            class="w-4/5 max-w-xs shrink-0 bg-white rounded-2xl shadow-md text-center p-6 mx-3 md:w-1/3"
          >
            <div class="mb-6">
              <img
                src="{% static 'juliana2.webp' %}"
                alt="Full-Time Placement Service"
                class="w-full h-48 object-cover rounded-xl mb-4"
                loading="lazy"
              />
            </div>
            <h3 class="text-2xl font-bold text-[#011E41] mb-2">
              Full-Time Placement
            </h3>
            <p class="text-[#4A5A70] text-lg leading-relaxed">
              Hire screened live-in or live-out help.
            </p>
          </div>
        </div>
      </div>

      <!-- Dots Indicator -->
      <div class="flex justify-center gap-2 mt-8">
        <template x-for="(_, index) in getDots()" :key="index">
          <button
            @click="goToSlide(index)"
            :class="isActiveDot(index) ? 'bg-[#011E41]' : 'bg-gray-300'"
            class="w-3 h-3 rounded-full transition-colors"
            :aria-label="`Go to service group ${index + 1}`"
          ></button>
        </template>
      </div>
    </div>

    <!-- CTA Button -->
    <div class="text-center mt-16">
      <a
        href="/services/"
        class="bg-[#011E41] text-[#FDEA00] font-semibold px-8 py-4 rounded-full text-xl shadow-lg hover:bg-[#022951] transition-colors inline-flex items-center gap-3"
        hx-get="/services/"
        hx-target="body"
        hx-swap="outerHTML"
      >
        View Full Service List
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          />
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- Alpine.js Services Carousel Component -->
<script>
  function servicesCarousel() {
    return {
      currentSlide: 0,
      totalSlides: 5,
      slidesPerView: 1,
      maxSlide: 4,
      touchStartX: 0,
      touchEndX: 0,
      minSwipeDistance: 50,

      init() {
        this.updateSlidesPerView();
        window.addEventListener("resize", () => {
          this.updateSlidesPerView();
        });
      },

      updateSlidesPerView() {
        if (window.innerWidth >= 768) {
          this.slidesPerView = 3;
          this.maxSlide = this.totalSlides - this.slidesPerView;
        } else {
          this.slidesPerView = 1;
          this.maxSlide = this.totalSlides - 1;
        }

        // Ensure current slide is within bounds
        if (this.currentSlide > this.maxSlide) {
          this.currentSlide = this.maxSlide;
        }
      },

      getTranslateX() {
        if (window.innerWidth >= 768) {
          // Desktop: move by percentage based on 3-card view
          return (this.currentSlide * 100) / 3;
        } else {
          // Mobile: move by full card width with margin
          return this.currentSlide * 86.67; // Account for w-4/5 + margins
        }
      },

      nextSlide() {
        if (this.currentSlide < this.maxSlide) {
          this.currentSlide++;
        }
      },

      prevSlide() {
        if (this.currentSlide > 0) {
          this.currentSlide--;
        }
      },

      goToSlide(index) {
        if (index >= 0 && index <= this.maxSlide) {
          this.currentSlide = index;
        }
      },

      getDots() {
        return Array(this.maxSlide + 1);
      },

      isActiveDot(index) {
        return index === this.currentSlide;
      },

      // Touch/Swipe Handlers
      handleTouchStart(e) {
        this.touchStartX = e.touches[0].clientX;
      },

      handleTouchMove(e) {
        this.touchEndX = e.touches[0].clientX;
      },

      handleTouchEnd(e) {
        if (!this.touchStartX || !this.touchEndX) return;

        const distance = this.touchStartX - this.touchEndX;
        const isLeftSwipe = distance > this.minSwipeDistance;
        const isRightSwipe = distance < -this.minSwipeDistance;

        if (isLeftSwipe && this.currentSlide < this.maxSlide) {
          this.nextSlide();
        }
        if (isRightSwipe && this.currentSlide > 0) {
          this.prevSlide();
        }

        // Reset
        this.touchStartX = 0;
        this.touchEndX = 0;
      },
    };
  }
</script>
