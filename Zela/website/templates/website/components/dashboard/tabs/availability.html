<!-- Availability & Service Area Tab -->
{{ provider.is_available|json_script:"provider-is-available" }}
{{ provider.accepts_same_day|json_script:"provider-accepts-same-day" }}
{{ working_hours|json_script:"working-hours-data" }}
{{ time_off_requests|json_script:"time-off-requests-data" }}
{{ service_areas|json_script:"service-areas-data" }}

<div
  x-show="currentTab === 'availability' && isProviderMode"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0 transform translate-y-4"
  x-transition:enter-end="opacity-100 transform translate-y-0"
  class="space-y-6"
  x-init="
    const providerIsAvailable = JSON.parse(document.getElementById('provider-is-available').textContent || 'false');
    const providerAcceptsSameDay = JSON.parse(document.getElementById('provider-accepts-same-day').textContent || 'false');
    const workingHoursData = JSON.parse(document.getElementById('working-hours-data').textContent || '{}');
    const timeOffRequestsData = JSON.parse(document.getElementById('time-off-requests-data').textContent || '[]');
    const serviceAreasData = JSON.parse(document.getElementById('service-areas-data').textContent || '[]');
    
    // Ensure we only have the 7 days of the week
    const validDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    const filteredWorkingHours = {};
    
    // If working hours data exists, filter to only valid days
    if (workingHoursData && typeof workingHoursData === 'object') {
      for (const day of validDays) {
        if (workingHoursData[day]) {
          filteredWorkingHours[day] = workingHoursData[day];
        } else {
          // Add default if missing
          filteredWorkingHours[day] = {
            enabled: day !== 'sunday',
            start: '08:00',
            end: day === 'saturday' ? '16:00' : (day === 'sunday' ? '15:00' : '18:00')
          };
        }
      }
    } else {
      // Create default working hours
      for (const day of validDays) {
        filteredWorkingHours[day] = {
          enabled: day !== 'sunday',
          start: '08:00',
          end: day === 'saturday' ? '16:00' : (day === 'sunday' ? '15:00' : '18:00')
        };
      }
    }
    
    isAvailable = providerIsAvailable;
    quickToggleToday = providerAcceptsSameDay;
    workingHours = filteredWorkingHours;
    timeOffRequests = timeOffRequestsData;
    serviceAreas = serviceAreasData;
  "
  x-data="{
    isAvailable: false,
    workingHours: {},
    timeOffRequests: [],
    serviceAreas: [],
    quickToggleToday: false,
    scheduleModified: false,
    
    calculateHours(start, end) {
      const startHour = parseInt(start.split(':')[0]);
      const endHour = parseInt(end.split(':')[0]);
      return endHour - startHour;
    },
    
    calculateTotalWeeklyHours() {
      let total = 0;
      const validDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      for (const day of validDays) {
        if (this.workingHours[day] && this.workingHours[day].enabled) {
          total += this.calculateHours(this.workingHours[day].start, this.workingHours[day].end);
        }
      }
      return total;
    },
    
    copyLastWeekSchedule() {
      alert('This would copy last week schedule');
    },
    
    async updateAvailability() {
      try {
        const response = await fetch('/dashboard/provider/availability/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: JSON.stringify({
            is_available: this.isAvailable,
            accepts_same_day: this.quickToggleToday
          })
        });
        
        const data = await response.json();
        if (data.ok) {
          // Update local state with server response to ensure sync
          this.isAvailable = data.is_available;
          this.quickToggleToday = data.accepts_same_day;
          showNotification('Availability updated successfully!', 'success');
        } else {
          alert('Error updating availability: ' + data.error);
          // Revert the toggle on error
          this.isAvailable = !this.isAvailable;
          this.quickToggleToday = !this.quickToggleToday;
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Network error updating availability');
        // Revert the toggle on error
        this.isAvailable = !this.isAvailable;
        this.quickToggleToday = !this.quickToggleToday;
      }
    },
    
    async saveSchedule() {
      try {
        const response = await fetch('/dashboard/provider/schedule/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: JSON.stringify({
            working_hours: this.workingHours
          })
        });
        
        const data = await response.json();
        if (data.ok) {
          this.scheduleModified = false;
          showNotification('Schedule saved successfully!', 'success');
        } else {
          alert('Error saving schedule: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Network error saving schedule');
      }
    },
    
    cancelTimeOffRequest(requestId) {
      if (confirm('Are you sure you want to cancel this time off request?')) {
        this.timeOffRequests = this.timeOffRequests.filter(r => r.id !== requestId);
        console.log('Cancelling time off request:', requestId);
      }
    },
    
    getOrderedWorkingDays() {
      const dayOrder = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const orderedDays = [];
      for (const day of dayOrder) {
        if (this.workingHours[day]) {
          orderedDays.push({ name: day, ...this.workingHours[day] });
        }
      }
      return orderedDays;
    }
  }">
  <!-- Availability Status Toggle -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="text-lg font-semibold" style="color: #011e41">Availability Status</h3>
        <p class="text-sm text-gray-600">Toggle your availability for accepting new jobs</p>
      </div>
      <button
        @click="isAvailable = !isAvailable; updateAvailability()"
        class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer"
        :style="isAvailable ? 'background-color: #035d73' : 'background-color: #e5e7eb'"
      >
        <span
          class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform shadow-sm"
          :class="isAvailable ? 'translate-x-7' : 'translate-x-1'"
        ></span>
      </button>
    </div>
    
    <div 
      class="p-4 rounded-lg border transition-all duration-200"
      :class="isAvailable ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'"
    >
      <div class="flex items-center">
        <div class="p-2 rounded-full mr-3" :class="isAvailable ? 'bg-green-100' : 'bg-red-100'">
          <svg 
            class="w-5 h-5"
            :class="isAvailable ? 'text-green-600' : 'text-red-600'"
            fill="none" stroke="currentColor" viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" :d="isAvailable ? 'M9 12l2 2 4-4' : 'M6 18L18 6M6 6l12 12'"/>
          </svg>
        </div>
        <div>
          <span 
            class="font-medium text-lg"
            :class="isAvailable ? 'text-green-800' : 'text-red-800'"
            x-text="isAvailable ? 'Currently Available for Jobs' : 'Currently Unavailable'"
          ></span>
          <p 
            class="text-sm mt-1"
            :class="isAvailable ? 'text-green-700' : 'text-red-700'"
            x-text="isAvailable ? 'You will receive job notifications and booking requests' : 'You will not receive new job requests until you become available'"
          ></p>
        </div>
      </div>
    </div>
    
    <!-- Stats when available -->
    <div x-show="isAvailable" class="mt-4 grid grid-cols-3 gap-4" x-transition>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-2xl font-bold" style="color: #035d73">{{ provider.jobs_completed|default:0 }}</div>
        <div class="text-xs text-gray-600">Jobs Today</div>
      </div>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-2xl font-bold" style="color: #035d73">{{ upcoming_jobs_count|default:0 }}</div>
        <div class="text-xs text-gray-600">Upcoming</div>
      </div>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-2xl font-bold" style="color: #035d73">{{ provider.completion_rate|floatformat:0|default:0 }}%</div>
        <div class="text-xs text-gray-600">Completion</div>
      </div>
    </div>
  </div>

  <!-- Quick Same-Day Toggle -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="text-lg font-semibold" style="color: #011e41">Same-Day Bookings</h3>
        <p class="text-sm text-gray-600">Accept bookings for today with short notice</p>
      </div>
      <button
        @click="quickToggleToday = !quickToggleToday; updateAvailability()"
        class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer"
        :style="quickToggleToday ? 'background-color: #fdea00' : 'background-color: #e5e7eb'"
      >
        <span
          class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform shadow-sm"
          :class="quickToggleToday ? 'translate-x-7' : 'translate-x-1'"
        ></span>
      </button>
    </div>
    
    <div class="p-4 rounded-lg transition-all duration-200" 
         :class="quickToggleToday ? 'bg-yellow-50 border border-yellow-200' : 'bg-gray-50 border border-gray-200'">
      <div class="flex items-center">
        <div class="p-2 rounded-full mr-3" :class="quickToggleToday ? 'bg-yellow-100' : 'bg-gray-100'">
          <svg class="w-5 h-5" :class="quickToggleToday ? 'text-yellow-600' : 'text-gray-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <span class="font-medium" :class="quickToggleToday ? 'text-yellow-800' : 'text-gray-700'" 
                x-text="quickToggleToday ? 'Accepting Same-Day Bookings' : 'Same-Day Bookings Disabled'"></span>
          <p class="text-sm mt-1" :class="quickToggleToday ? 'text-yellow-700' : 'text-gray-600'"
             x-text="quickToggleToday ? 'Customers can book you for jobs starting in 2+ hours' : 'You only accept advance bookings (tomorrow onwards)'"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Schedule -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold" style="color: #011e41">Weekly Working Hours</h3>
      <button 
        @click="copyLastWeekSchedule()"
        class="text-sm px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        style="color: #035d73"
      >
        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
        </svg>
        Copy Last Week
      </button>
    </div>
    
    <div class="space-y-3">
      <template x-for="day in getOrderedWorkingDays()" :key="day.name">
        <div class="flex items-center justify-between p-4 border rounded-lg transition-all duration-200"
             :class="day.enabled ? 'border-green-200 bg-green-50' : 'border-gray-200 bg-gray-50'">
          <div class="flex items-center">
            <button
              @click="workingHours[day.name].enabled = !workingHours[day.name].enabled; scheduleModified = true"
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer"
              :style="workingHours[day.name].enabled ? 'background-color: #035d73' : 'background-color: #e5e7eb'"
            >
              <span
                class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-sm"
                :class="workingHours[day.name].enabled ? 'translate-x-6' : 'translate-x-1'"
              ></span>
            </button>
            <div class="ml-3">
              <span class="text-sm font-medium text-gray-900 capitalize" x-text="day.name"></span>
              <span class="ml-2 text-xs" :class="workingHours[day.name].enabled ? 'text-green-600' : 'text-gray-500'">
                <template x-if="workingHours[day.name].enabled">
                  <span x-text="`${calculateHours(workingHours[day.name].start, workingHours[day.name].end)} hours`"></span>
                </template>
                <template x-if="!workingHours[day.name].enabled">
                  <span>Day off</span>
                </template>
              </span>
            </div>
          </div>
          
          <div class="flex items-center space-x-2" x-show="workingHours[day.name].enabled" x-transition>
            <select 
              x-model="workingHours[day.name].start"
              @change="scheduleModified = true"
              class="text-sm border border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-offset-0"
              :style="'border-color: #035d73; focus:ring-color: #035d73'"
            >
              <option value="05:00">05:00 AM</option>
              <option value="06:00">06:00 AM</option>
              <option value="07:00">07:00 AM</option>
              <option value="08:00">08:00 AM</option>
              <option value="09:00">09:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
            </select>
            <span class="text-gray-500 text-sm">to</span>
            <select 
              x-model="workingHours[day.name].end"
              @change="scheduleModified = true"
              class="text-sm border border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-offset-0"
              :style="'border-color: #035d73; focus:ring-color: #035d73'"
            >
              <option value="12:00">12:00 PM</option>
              <option value="13:00">01:00 PM</option>
              <option value="14:00">02:00 PM</option>
              <option value="15:00">03:00 PM</option>
              <option value="16:00">04:00 PM</option>
              <option value="17:00">05:00 PM</option>
              <option value="18:00">06:00 PM</option>
              <option value="19:00">07:00 PM</option>
              <option value="20:00">08:00 PM</option>
              <option value="21:00">09:00 PM</option>
              <option value="22:00">10:00 PM</option>
            </select>
          </div>
        </div>
      </template>
    </div>
    
    <!-- Total weekly hours summary -->
    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600">Total weekly hours:</span>
        <span class="font-semibold" style="color: #035d73" x-text="calculateTotalWeeklyHours() + ' hours'"></span>
      </div>
    </div>
    
    <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
      <button 
        @click="saveSchedule()"
        class="px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors" 
        style="background-color: #035d73; cursor: pointer" 
        onmouseover="this.style.backgroundColor='#024954'" 
        onmouseout="this.style.backgroundColor='#035d73'"
      >
        Save Schedule
      </button>
      <span class="text-xs text-gray-500" x-show="scheduleModified" x-transition>
        <svg class="w-4 h-4 inline text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 3.5c-.77.833.192 3 1.732 3z"/>
        </svg>
        Unsaved changes
      </span>
    </div>
  </div>

  <!-- Service Areas -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="text-lg font-semibold" style="color: #011e41">Service Areas & Coverage</h3>
        <p class="text-sm text-gray-600">Select the areas where you provide services</p>
      </div>
      <span class="text-sm px-3 py-1 rounded-full" style="background-color: #e6f7ff; color: #035d73">
        <span x-text="serviceAreas.filter(a => a.enabled).length"></span> of <span x-text="serviceAreas.length"></span> active
      </span>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      {% if service_areas %}
      <template x-for="area in serviceAreas" :key="area.name">
        <div 
          class="flex items-center justify-between p-4 border rounded-lg transition-all duration-200 hover:shadow-sm"
          :class="area.enabled ? 'border-green-200 bg-green-50' : 'border-gray-200 bg-white'"
        >
          <div class="flex items-center">
            <button
              @click="area.enabled = !area.enabled; scheduleModified = true"
              class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer"
              :style="area.enabled ? 'background-color: #035d73' : 'background-color: #e5e7eb'"
            >
              <span
                class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-sm"
                :class="area.enabled ? 'translate-x-6' : 'translate-x-1'"
              ></span>
            </button>
            <div class="ml-3">
              <div class="flex items-center">
                <div class="w-3 h-3 rounded-full mr-2" :style="'background-color: ' + area.color"></div>
                <span class="text-sm font-medium text-gray-900" x-text="area.name"></span>
              </div>
              <div class="text-xs text-gray-500 mt-0.5">
                <template x-if="area.surcharge > 0">
                  <span>+R$ <span x-text="area.surcharge"></span> surcharge</span>
                </template>
                <template x-if="area.surcharge === 0">
                  <span class="text-green-600">No surcharge</span>
                </template>
              </div>
            </div>
          </div>
          
          <div class="text-right">
            <span 
              class="text-xs px-2 py-1 rounded-full font-medium"
              :class="area.enabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'"
              x-text="area.enabled ? 'Active' : 'Inactive'"
            ></span>
          </div>
        </div>
      </template>
      {% else %}
      <div class="col-span-2 text-center py-8">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No service areas configured</h3>
        <p class="mt-1 text-sm text-gray-500">Add service areas to start accepting jobs</p>
      </div>
      {% endif %}
    </div>
    
    <!-- Distance-based pricing summary -->
    <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
      <div class="flex items-start">
        <svg class="w-5 h-5 text-blue-600 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div class="text-sm">
          <p class="text-blue-800 font-medium">Distance-based surcharges</p>
          <p class="text-blue-700 mt-1">Areas further from city center have additional fees to cover travel costs</p>
        </div>
      </div>
    </div>
    
    <div class="mt-4 pt-4 border-t border-gray-200 flex gap-2">
      <button 
        @click="saveSchedule()"
        class="px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors" 
        style="background-color: #035d73; cursor: pointer" 
        onmouseover="this.style.backgroundColor='#024954'" 
        onmouseout="this.style.backgroundColor='#035d73'"
      >
        Update Service Areas
      </button>
      <button 
        @click="currentTab = 'service-area'"
        class="px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors" 
        style="background-color: #fdea00; color: #000; cursor: pointer" 
        onmouseover="this.style.backgroundColor='#fcd34d'" 
        onmouseout="this.style.backgroundColor='#fdea00'"
      >
        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
        </svg>
        View Coverage Map
      </button>
    </div>
  </div>

  <!-- Time Off Scheduler -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="text-lg font-semibold" style="color: #011e41">Time Off Requests</h3>
        <p class="text-sm text-gray-600">Manage your scheduled time off</p>
      </div>
      <button 
        @click="$dispatch('open-modal', 'time-off-modal')"
        class="px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors flex items-center" 
        style="background-color: #035d73; cursor: pointer" 
        onmouseover="this.style.backgroundColor='#024954'" 
        onmouseout="this.style.backgroundColor='#035d73'"
      >
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Request Time Off
      </button>
    </div>
    
    <div class="space-y-3">
      <template x-if="timeOffRequests.length > 0">
        <div class="space-y-3">
          <template x-for="request in timeOffRequests" :key="request.id">
            <div 
              class="flex items-center justify-between p-4 border rounded-lg transition-all duration-200 hover:shadow-sm"
              :class="{
                'border-green-200 bg-green-50': request.status === 'approved',
                'border-yellow-200 bg-yellow-50': request.status === 'pending',
                'border-red-200 bg-red-50': request.status === 'rejected'
              }"
            >
              <div class="flex items-start">
                <div class="p-2 rounded-full mr-3" 
                     :class="{
                       'bg-green-100': request.status === 'approved',
                       'bg-yellow-100': request.status === 'pending',
                       'bg-red-100': request.status === 'rejected'
                     }">
                  <svg class="w-5 h-5" 
                       :class="{
                         'text-green-600': request.status === 'approved',
                         'text-yellow-600': request.status === 'pending',
                         'text-red-600': request.status === 'rejected'
                       }"
                       fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </div>
                <div>
                  <div class="font-medium text-gray-900" x-text="request.date"></div>
                  <div class="text-sm text-gray-600 mt-1" x-text="request.reason"></div>
                  <div class="text-xs text-gray-500 mt-1">
                    <span x-text="request.duration"></span> day(s) off
                  </div>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <span 
                  class="text-xs px-3 py-1 rounded-full font-medium capitalize"
                  :class="{
                    'bg-green-100 text-green-800': request.status === 'approved',
                    'bg-yellow-100 text-yellow-800': request.status === 'pending',
                    'bg-red-100 text-red-800': request.status === 'rejected'
                  }"
                  x-text="request.status"
                ></span>
                <button 
                  x-show="request.status === 'pending'"
                  @click="cancelTimeOffRequest(request.id)"
                  class="text-gray-400 hover:text-red-600 transition-colors"
                  title="Cancel request"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            </div>
          </template>
        </div>
      </template>
      
      <template x-if="timeOffRequests.length === 0">
        <div class="text-center py-8">
          <div class="p-3 rounded-full bg-gray-100 w-16 h-16 mx-auto flex items-center justify-center">
            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <h3 class="mt-3 text-sm font-medium text-gray-900">No time off scheduled</h3>
          <p class="mt-1 text-sm text-gray-500">Request time off when you need a break</p>
          <button 
            @click="$dispatch('open-modal', 'time-off-modal')"
            class="mt-4 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"
          >
            Schedule Time Off
          </button>
        </div>
      </template>
    </div>
    
    <!-- Summary Stats -->
    <div x-show="timeOffRequests.length > 0" class="mt-4 grid grid-cols-3 gap-3" x-transition>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-lg font-bold" style="color: #035d73" x-text="timeOffRequests.filter(r => r.status === 'approved').length"></div>
        <div class="text-xs text-gray-600">Approved</div>
      </div>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-lg font-bold" style="color: #fdea00" x-text="timeOffRequests.filter(r => r.status === 'pending').length"></div>
        <div class="text-xs text-gray-600">Pending</div>
      </div>
      <div class="text-center p-3 bg-gray-50 rounded-lg">
        <div class="text-lg font-bold text-red-600" x-text="timeOffRequests.filter(r => r.status === 'rejected').length"></div>
        <div class="text-xs text-gray-600">Rejected</div>
      </div>
    </div>
    
    <div class="mt-4 p-4 rounded-lg" style="background-color: #e6f7ff">
      <div class="flex items-start">
        <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" style="color: #035d73" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div class="text-sm">
          <div class="font-medium" style="color: #035d73">Time Off Policy</div>
          <div class="mt-1" style="color: #024954">
            • Submit requests at least 48 hours in advance<br>
            • Same-day sick leave is allowed with proper documentation<br>
            • Vacation requests need 1 week advance notice
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h3 class="text-lg font-semibold mb-4" style="color: #011e41">Quick Actions</h3>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <button class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors" style="cursor: pointer">
        <div class="p-2 rounded-lg mr-3" style="background-color: #e6f7ff">
          <svg class="h-5 w-5" style="color: #035d73" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="text-left">
          <div class="font-medium text-gray-900">Copy Last Week</div>
          <div class="text-sm text-gray-500">Duplicate schedule</div>
        </div>
      </button>

      <button class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors" style="cursor: pointer">
        <div class="p-2 rounded-lg mr-3" style="background-color: #fff7e6">
          <svg class="h-5 w-5" style="color: #fdea00" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="text-left">
          <div class="font-medium text-gray-900">Extended Hours</div>
          <div class="text-sm text-gray-500">Temporary availability</div>
        </div>
      </button>

      <button class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors" style="cursor: pointer">
        <div class="p-2 rounded-lg mr-3" style="background-color: #e6f7ff">
          <svg class="h-5 w-5" style="color: #035d73" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
          </svg>
        </div>
        <div class="text-left">
          <div class="font-medium text-gray-900">Travel Preferences</div>
          <div class="text-sm text-gray-500">Distance settings</div>
        </div>
      </button>
    </div>
  </div>
</div>

<script>
// Helper function to get CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// Helper function to show notifications
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 transition-all duration-300 transform translate-x-full`;
  
  // Set background color based on type
  if (type === 'success') {
    notification.style.backgroundColor = '#035d73';
  } else if (type === 'error') {
    notification.style.backgroundColor = '#dc2626';
  } else {
    notification.style.backgroundColor = '#3b82f6';
  }
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.classList.remove('translate-x-full');
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.classList.add('translate-x-full');
    setTimeout(() => {
      notification.remove();
    }, 300);
  }, 3000);
}
</script>
