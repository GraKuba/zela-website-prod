<!-- Customer Bookings Tab -->
<div
  x-show="currentTab === 'bookings' && !isProviderMode"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0 transform translate-y-4"
  x-transition:enter-end="opacity-100 transform translate-y-0"
  x-data="{ bookingSubTab: 'upcoming' }"
  class="space-y-6"
>
  <!-- Header -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-bold" style="color: #011e41">Minhas Reservas</h2>
        <p class="text-gray-600 mt-1">
          Gerencie e acompanhe todos os seus serviços agendados
        </p>
      </div>
      <button
        @click="window.location.href = '/book/'"
        class="px-6 py-3 rounded-full font-semibold text-sm transition-all duration-200 transform hover:-translate-y-1 hover:shadow-lg cursor-pointer"
        style="background-color: #fdea00; color: #011e41"
      >
        Reservar Novo Serviço
      </button>
    </div>
  </div>

  <!-- Sub-tabs -->
  <div
    class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
  >
    <div class="flex border-b border-gray-200">
      <button
        @click="bookingSubTab = 'upcoming'"
        class="flex-1 py-4 px-6 text-sm font-medium text-center transition-colors duration-200 cursor-pointer"
        :class="bookingSubTab === 'upcoming' ? 'text-white border-b-2' : 'text-gray-500 hover:text-gray-700'"
        :style="bookingSubTab === 'upcoming' ? 'background-color: #035d73; border-color: #035d73' : ''"
      >
        Próximas
        <span
          class="ml-2 text-xs font-medium px-2 py-1 rounded-full"
          :class="bookingSubTab === 'upcoming' ? 'bg-white' : 'bg-gray-100'"
          :style="bookingSubTab === 'upcoming' ? 'color: #035d73' : 'color: #666'"
        >{{ upcoming_bookings_count }}</span>
      </button>
      <button
        @click="bookingSubTab = 'recurring'"
        class="flex-1 py-4 px-6 text-sm font-medium text-center transition-colors duration-200 cursor-pointer"
        :class="bookingSubTab === 'recurring' ? 'text-white border-b-2' : 'text-gray-500 hover:text-gray-700'"
        :style="bookingSubTab === 'recurring' ? 'background-color: #035d73; border-color: #035d73' : ''"
      >
        Recorrentes
        <span
          class="ml-2 bg-gray-100 text-gray-800 text-xs font-medium px-2 py-1 rounded-full"
          >{{ recurring_bookings_count }}</span
        >
      </button>
      <button
        @click="bookingSubTab = 'completed'"
        class="flex-1 py-4 px-6 text-sm font-medium text-center transition-colors duration-200 cursor-pointer"
        :class="bookingSubTab === 'completed' ? 'text-white border-b-2' : 'text-gray-500 hover:text-gray-700'"
        :style="bookingSubTab === 'completed' ? 'background-color: #035d73; border-color: #035d73' : ''"
      >
        Concluídas
        <span
          class="ml-2 text-xs font-medium px-2 py-1 rounded-full"
          style="background-color: #fdea00; color: #035d73"
        >{{ completed_bookings_count }}</span>
      </button>
      <button
        @click="bookingSubTab = 'canceled'"
        class="flex-1 py-4 px-6 text-sm font-medium text-center transition-colors duration-200 cursor-pointer"
        :class="bookingSubTab === 'canceled' ? 'text-white border-b-2' : 'text-gray-500 hover:text-gray-700'"
        :style="bookingSubTab === 'canceled' ? 'background-color: #035d73; border-color: #035d73' : ''"
      >
        Canceladas
        <span
          class="ml-2 bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full"
          >{{ cancelled_bookings_count }}</span
        >
      </button>
    </div>

    <!-- Upcoming Bookings -->
    <div x-show="bookingSubTab === 'upcoming'" class="p-6">
      <div class="space-y-4">
        {% if upcoming_bookings_list %}
          {% for booking in upcoming_bookings_list %}
          <!-- Booking Card -->
          <div
            class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200"
          >
            <div class="flex items-start justify-between">
              <div class="flex items-start space-x-4">
                <div 
                  class="w-16 h-16 rounded-full flex items-center justify-center"
                  style="background-color: #035d73"
                >
                  {% if booking.provider %}
                    <span class="text-white text-xl font-semibold">
                      {{ booking.provider.get_full_name|first|upper }}
                    </span>
                  {% else %}
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <div class="flex items-center space-x-2">
                    <h3 class="font-semibold text-gray-900">{{ booking.service_task.name }}</h3>
                    <span
                      class="px-2 py-1 text-xs font-medium rounded-full"
                      {% if booking.status == 'pending_confirmation' %}
                        style="background-color: #ff9800; color: white"
                      {% elif booking.status == 'pending' %}
                        style="background-color: #fdea00; color: #035d73"
                      {% elif booking.status == 'accepted' %}
                        style="background-color: #035d73; color: white"
                      {% else %}
                        style="background-color: #035d73; color: white"
                      {% endif %}
                    >
                      {% if booking.status == 'pending_confirmation' %}Confirmação Pendente{% elif booking.status == 'pending' %}Pendente{% elif booking.status == 'accepted' %}Confirmada{% else %}Em Progresso{% endif %}
                    </span>
                  </div>
                  {% if booking.provider %}
                    <p class="text-sm text-gray-600 mt-1">
                      {{ booking.provider.get_full_name }} 
                      {% if booking.provider.provider and booking.provider.provider.rating_average %}
                        • {{ booking.provider.provider.rating_average }} ⭐
                      {% endif %}
                    </p>
                  {% else %}
                    <p class="text-sm text-gray-600 mt-1">Prestador a ser atribuído</p>
                  {% endif %}
                  <div class="flex items-center text-sm text-gray-500 mt-2">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                      />
                    </svg>
                    <span>{{ booking.start_at|date:"M d, Y" }} • {{ booking.start_at|time:"g:i A" }} - {{ booking.end_at|time:"g:i A" }}</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-500 mt-1">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                    </svg>
                    <span>{{ booking.address|truncatechars:50 }}</span>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-lg font-semibold" style="color: #011e41">
                  Kz {{ booking.total_price|floatformat:0 }}
                </div>
                <div class="flex space-x-2 mt-3">
                  {% if booking.can_be_cancelled %}
                  <button
                    class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition-colors cursor-pointer"
                  >
                    Remarcar
                  </button>
                  {% endif %}
                  <button
                    class="px-3 py-1 text-white rounded-lg text-sm hover:opacity-90 transition-colors cursor-pointer"
                    style="background-color: #035d73"
                  >
                    Contactar
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <!-- No bookings state -->
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Sem reservas próximas</h3>
            <p class="mt-1 text-sm text-gray-500">Comece reservando o seu primeiro serviço.</p>
            <div class="mt-6">
              <button
                @click="window.location.href = '/book/'"
                class="inline-flex items-center px-4 py-2 rounded-full font-semibold text-sm transition-all duration-200 transform hover:-translate-y-1 hover:shadow-lg cursor-pointer"
                style="background-color: #fdea00; color: #011e41"
              >
                Reservar um Serviço
              </button>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Recurring Bookings -->
    <div x-show="bookingSubTab === 'recurring'" class="p-6">
      <div class="space-y-4">
        {% if recurring_bookings_list %}
          {% for booking in recurring_bookings_list %}
          <!-- Recurring Booking Card -->
          <div
            class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200"
          >
            <!-- Dynamic recurring booking content would go here -->
          </div>
          {% endfor %}
        {% else %}
          <!-- No recurring bookings state -->
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Sem reservas recorrentes</h3>
            <p class="mt-1 text-sm text-gray-500">Configure serviços recorrentes para limpeza regular.</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Completed Bookings -->
    <div x-show="bookingSubTab === 'completed'" class="p-6">
      <div class="space-y-4">
        {% if completed_bookings_list %}
          {% for booking in completed_bookings_list %}
          <!-- Completed Booking Card -->
          <div
            class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200"
          >
            <div class="flex items-start justify-between">
              <div class="flex items-start space-x-4">
                <div 
                  class="w-16 h-16 rounded-full flex items-center justify-center"
                  style="background-color: #035d73"
                >
                  {% if booking.provider %}
                    <span class="text-white text-xl font-semibold">
                      {{ booking.provider.get_full_name|first|upper }}
                    </span>
                  {% else %}
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <div class="flex items-center space-x-2">
                    <h3 class="font-semibold text-gray-900">{{ booking.service_task.name }}</h3>
                    <span
                      class="px-2 py-1 text-xs font-medium rounded-full"
                      style="background-color: #fdea00; color: #035d73"
                    >Concluída</span>
                  </div>
                  {% if booking.provider %}
                    <p class="text-sm text-gray-600 mt-1">
                      {{ booking.provider.get_full_name }} 
                      {% if booking.provider.provider and booking.provider.provider.rating_average %}
                        • {{ booking.provider.provider.rating_average }} ⭐
                      {% endif %}
                    </p>
                  {% endif %}
                  <div class="flex items-center text-sm text-gray-500 mt-2">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                      />
                    </svg>
                    <span>{{ booking.start_at|date:"M d, Y" }} • {{ booking.start_at|time:"g:i A" }} - {{ booking.end_at|time:"g:i A" }}</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-500 mt-1">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                    </svg>
                    <span>{{ booking.address|truncatechars:50 }}</span>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-lg font-semibold" style="color: #011e41">
                  Kz {{ booking.total_price|floatformat:0 }}
                </div>
                <div class="flex space-x-2 mt-3">
                  <button
                    class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition-colors cursor-pointer"
                  >
                    Reservar Novamente
                  </button>
                  {% if booking.can_be_rated %}
                  <button
                    class="px-3 py-1 text-white rounded-lg text-sm hover:opacity-90 transition-colors cursor-pointer"
                    style="background-color: #035d73"
                  >
                    Avaliar Serviço
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <!-- No completed bookings state -->
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Sem reservas concluídas</h3>
            <p class="mt-1 text-sm text-gray-500">Os seus serviços concluídos aparecerão aqui.</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Canceled Bookings -->
    <div x-show="bookingSubTab === 'canceled'" class="p-6">
      <div class="space-y-4">
        {% if cancelled_bookings_list %}
          {% for booking in cancelled_bookings_list %}
          <!-- Canceled Booking Card -->
          <div
            class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow duration-200 opacity-75"
          >
            <div class="flex items-start justify-between">
              <div class="flex items-start space-x-4">
                <div 
                  class="w-16 h-16 rounded-full flex items-center justify-center"
                  style="background-color: #035d73"
                >
                  {% if booking.provider %}
                    <span class="text-white text-xl font-semibold">
                      {{ booking.provider.get_full_name|first|upper }}
                    </span>
                  {% else %}
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <div class="flex items-center space-x-2">
                    <h3 class="font-semibold text-gray-900">{{ booking.service_task.name }}</h3>
                    <span
                      class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full"
                    >Cancelada</span>
                  </div>
                  {% if booking.provider %}
                    <p class="text-sm text-gray-600 mt-1">
                      {{ booking.provider.get_full_name }} 
                      {% if booking.provider.provider and booking.provider.provider.rating_average %}
                        • {{ booking.provider.provider.rating_average }} ⭐
                      {% endif %}
                    </p>
                  {% endif %}
                  <div class="flex items-center text-sm text-gray-500 mt-2">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                      />
                    </svg>
                    <span>{{ booking.start_at|date:"M d, Y" }} • {{ booking.start_at|time:"g:i A" }} - {{ booking.end_at|time:"g:i A" }}</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-500 mt-1">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                    </svg>
                    <span>{{ booking.address|truncatechars:50 }}</span>
                  </div>
                  <div class="flex items-center text-sm text-red-600 mt-2">
                    <svg
                      class="mr-1 h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    <span>Cancelada em {{ booking.updated_at|date:"d M, Y" }}</span>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-lg font-semibold text-gray-500 line-through">
                  Kz {{ booking.total_price|floatformat:0 }}
                </div>
                <div class="text-sm mt-1" style="color: #035d73">Reembolsado</div>
                <div class="flex space-x-2 mt-3">
                  <button
                    class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition-colors cursor-pointer"
                  >
                    Reservar Novamente
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <!-- No cancelled bookings state -->
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Sem reservas canceladas</h3>
            <p class="mt-1 text-sm text-gray-500">Os seus serviços cancelados aparecerão aqui.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
