{% load static %}
<!-- ========================  HERO SECTION  ======================== -->
<!-- Mobile/tablet: stacked layout, Large screens: text takes 2 columns, photos take 3 columns -->
<div
  class="flex flex-col lg:grid lg:grid-cols-5 h-auto lg:h-[calc(100vh-80px)] mx-auto relative z-10 max-w-[1280px] px-4 md:px-6 lg:px-8"
>
  <!-- ========================  TOP GRADIENT FADE OVERLAY  ======================== -->
  <!-- Gradient overlay at the very top of page to fade out photos behind navbar -->
  <div
    class="absolute -top-24 left-0 right-0 h-36 bg-[linear-gradient(to_bottom,_white_0%,_white_25%,_transparent_100%)] z-30 pointer-events-none"
  ></div>
  <!-- ───────────────  LEFT: title + CTA  (2 columns on lg, full width on smaller) ─────────────── -->
  <div
    class="order-1 lg:row-start-1 lg:col-start-1 lg:col-span-2 w-full max-w-md mx-auto lg:max-w-none flex flex-col justify-center lg:justify-start py-12 md:py-16 lg:py-16 relative z-40 bg-transparent lg:bg-transparent"
  >
    <h1
      class="text-4xl md:text-5xl lg:text-6xl font-semibold text-foreground mb-4 md:mb-6 text-center lg:text-left relative z-10"
    >
      O Seu Lar, <br class="hidden lg:block" />A Nossa Prioridade
    </h1>
    <p
      class="text-base md:text-lg lg:text-xl text-muted-foreground mb-6 md:mb-8 max-w-md text-center lg:text-left mx-auto lg:mx-0 relative z-10"
    >
      Reserve serviços domésticos de confiança de forma rápida
    </p>

    <!-- Feature bullets -->
    <div
      class="space-y-3 md:space-y-4 flex flex-col items-center lg:items-start relative z-10"
    >
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-foreground text-sm md:text-base font-medium"
          >Profissionais de confiança, 5-estrelas</span
        >
      </div>
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-foreground text-sm md:text-base font-medium"
          >Reserva em menos de 60 segundos</span
        >
      </div>
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-foreground text-sm md:text-base font-medium"
          >Garantia "Lar Impecável"</span
        >
      </div>
    </div>
    <div class="flex justify-center lg:justify-start relative z-10">
      {% if user.is_authenticated %}
      <a
        href="{% url 'website:dashboard' %}"
        class="bg-primary text-primary-foreground px-6 py-2 rounded-full font-semibold hover:bg-primary/90 transition-colors shadow-lg w-fit my-6 md:my-8 cursor-pointer inline-block"
        hx-get="{% url 'website:dashboard' %}"
        hx-target="body"
        hx-swap="outerHTML"
      >
        Ir para o Painel
      </a>
      {% else %}
      <a
        href="{% url 'website:services-preview' %}"
        class="bg-[#F4D35E] text-[#011E41] px-6 py-2 rounded-full font-semibold hover:bg-[#F4D35E]/90 transition-colors shadow-lg w-fit my-6 md:my-8 cursor-pointer inline-block"
      >
        Agende Já
      </a>
      {% endif %}
    </div>

    <!-- Referral Section -->
    <div class="mt-4 md:mt-6 relative z-10">
      <div class="flex items-center gap-3 justify-center lg:justify-start">
        <img
          src="{% static 'zela-workers-new-photos/antonia-cabala-2.jpeg' %}"
          alt="Cliente Antonia"
          class="w-8 h-8 rounded-full object-cover"
        />
        <div>
          <div
            class="text-xs font-bold text-foreground uppercase tracking-wider"
          >
            REFIRA E GANHE CRÉDITO
          </div>
          <p class="text-xs text-muted-foreground">
            Partilhe-nos para ganhar descontos.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ───────────────  RIGHT: AUTO-SCROLL PROVIDER GRID  (3 columns) ─────────────── -->
  <div
    class="order-2 lg:row-start-1 lg:col-start-3 lg:col-span-3 w-full flex flex-col z-0 lg:z-10 h-[60vh] md:h-[70vh] lg:h-auto"
  >
    <!-- Three equal columns that scroll independently -->
    <div class="grid grid-cols-3 gap-3 h-full opacity-100">
      <!-- ===== COLUMN 1  – scrolls ↑  ===== -->
      <div
        class="h-full lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('up', 90000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-6 lg:space-y-8" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/antonia-cabala-2.jpeg' %}"
                alt="Antonia Cabala"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/milton-tomas-1.jpeg' %}"
                alt="Milton Tomas"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/madalena-rodrigues-1.jpeg' %}"
                alt="Madalena Rodrigues"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/marisa-gaspar-1.jpeg' %}"
                alt="Marisa Gaspar"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/maura-simao-1.jpeg' %}"
                alt="Maura Simão"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/vanuza-faustino-1.jpeg' %}"
                alt="Vanuza Faustino"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>

      <!-- ===== COLUMN 2  – scrolls ↓  ===== -->
      <div
        class="h-full lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('down', 120000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-6 lg:space-y-8" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/milton-tomas-2.jpeg' %}"
                alt="Milton Tomas"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/madalena-rodrigues-2.jpeg' %}"
                alt="Madalena Rodrigues"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/anotnia-cabala-1.jpeg' %}"
                alt="Antonia Cabala"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/marisa-gaspar-2.jpeg' %}"
                alt="Marisa Gaspar"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/maura-simao-2.jpeg' %}"
                alt="Maura Simão"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/antonia-cabala-2.jpeg' %}"
                alt="Antonia Cabala"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>

      <!-- ===== COLUMN 3  – scrolls ↑  ===== -->
      <div
        class="h-full lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('up', 150000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-6 lg:space-y-8" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/marisa-gaspar-2.jpeg' %}"
                alt="Marisa Gaspar"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/maura-simao-2.jpeg' %}"
                alt="Maura Simão"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/vanuza-faustino-1.jpeg' %}"
                alt="Vanuza Faustino"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/milton-tomas-1.jpeg' %}"
                alt="Milton Tomas"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/milton-tomas-2.jpeg' %}"
                alt="Milton Tomas"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'zela-workers-new-photos/madalena-rodrigues-2.jpeg' %}"
                alt="Madalena Rodrigues"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================  GRADIENT FADE OVERLAY  ======================== -->
  <!-- Gradient overlay at the bottom to fade out the photos -->
  <div
    class="absolute bottom-0 left-0 right-0 h-48 bg-[linear-gradient(to_top,_white_0%,_white_25%,_transparent_100%)] z-30 pointer-events-none"
  ></div>
</div>

<!-- ========================  SCRIPTS  ======================== -->
<script>
  /*
    scrollColumn(direction, duration)
      direction: 'up' | 'down'
      duration : milliseconds for one full loop
  */
  const scrollColumn = (direction = "up", duration = 30000) => ({
    _wrapper: null,
    _list: null,
    _listHeight: 0,
    _animationFrameId: null,

    start() {
      this._wrapper = this.$refs.wrapper;
      this._list = this.$refs.list;

      if (this._animationFrameId) {
        cancelAnimationFrame(this._animationFrameId);
      }

      // Defer execution to allow images to load and DOM to settle
      setTimeout(() => {
        this.setupAndRun();
      }, 100);
    },

    setupAndRun() {
      this._listHeight = this._list.offsetHeight;
      if (!this._listHeight) return;

      this.setupClones();

      const dir = direction === "up" ? -1 : 1;
      const isSmallScreen = window.innerWidth < 1024;
      const adjustedDuration = isSmallScreen ? duration * 1.5 : duration;
      const step = this._listHeight / (adjustedDuration / 16.67);

      let y;

      const currentTransform = window.getComputedStyle(this._wrapper).transform;
      if (currentTransform === "none") {
        y = 0;
      } else {
        y = new DOMMatrix(currentTransform).m42;
      }

      const animate = () => {
        y += dir * step;

        if (direction === "up") {
          if (y <= -this._listHeight) {
            y += this._listHeight;
          }
        } else {
          if (y >= 0) {
            y -= this._listHeight;
          }
        }

        this._wrapper.style.transform = `translateY(${y}px)`;
        this._animationFrameId = requestAnimationFrame(animate);
      };

      this._animationFrameId = requestAnimationFrame(animate);
    },

    setupClones() {
      // Clear any existing clones
      while (this._wrapper.children.length > 1) {
        this._wrapper.removeChild(this._wrapper.lastChild);
      }

      const containerHeight = this._wrapper.parentElement.offsetHeight;
      const cloneCount = Math.max(
        2,
        Math.ceil(containerHeight / this._listHeight) + 1
      );

      for (let i = 0; i < cloneCount; i++) {
        const clone = this._list.cloneNode(true);
        this._wrapper.appendChild(clone);
      }

      if (direction === "down") {
        // To scroll down seamlessly, we start with the list scrolled all the way to the end,
        // leaving one list-height's worth of content visible at the bottom for a smooth start.
        const totalHeight = this._wrapper.scrollHeight;
        this._wrapper.style.transform = `translateY(${
          -totalHeight + this._listHeight
        }px)`;
      }
    },
  });
</script>
