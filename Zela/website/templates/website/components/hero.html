{% load static %}
<!-- ========================  HERO SECTION  ======================== -->
<!-- Entire hero is one flex container: title/CTA left, auto-scroll grid right -->
<div
  class="grid lg:flex lg:flex-row h-[calc(100vh-80px)] mx-auto relative z-10 max-w-[1280px]"
>
  <!-- ========================  TOP GRADIENT FADE OVERLAY  ======================== -->
  <!-- Gradient overlay at the very top of page to fade out photos behind navbar -->
  <div
    class="absolute -top-24 left-0 right-0 h-36 bg-[linear-gradient(to_bottom,_white_0%,_white_25%,_transparent_100%)] z-30 pointer-events-none"
  ></div>
  <!-- ───────────────  LEFT: title + CTA  (≈35 %) ─────────────── -->
  <div
    class="row-start-1 col-start-1 w-full max-w-md mx-auto lg:w-[35%] flex flex-col justify-center lg:justify-start px-4 sm:px-6 md:px-8 lg:px-16 py-8 lg:py-16 relative z-40 bg-[radial-gradient(ellipse_at_center,_rgba(255,255,255,0.7)_10%,_rgba(255,255,255,0)_100%)] rounded-full lg:bg-transparent lg:rounded-none"
  >
    <h1
      class="text-5xl md:text-6xl lg:text-7xl font-semibold text-black mb-6 text-center lg:text-left relative z-10"
    >
      O seu lar,<br />
      a nossa<br />
      prioridade
    </h1>
    <p
      class="text-lg md:text-xl text-gray-700 mb-8 max-w-md text-center lg:text-left mx-auto lg:mx-0 relative z-10"
    >
      Reserve serviços domésticos de confiança de forma rápida
    </p>

    <!-- Feature bullets -->
    <div
      class="space-y-4 flex flex-col items-center lg:items-start relative z-10"
    >
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-gray-800 text-base font-medium"
          >Profissionais de confiança, 5-estrelas</span
        >
      </div>
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-gray-800 text-base font-medium"
          >Reserva em menos de 60 segundos</span
        >
      </div>
      <div class="flex items-center gap-3">
        <div
          class="flex-shrink-0 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <span class="text-gray-800 text-base font-medium"
          >Garantia "Lar Impecável"</span
        >
      </div>
    </div>
    <div class="flex justify-center lg:justify-start relative z-10">
      {% if user.is_authenticated %}
      <a
        href="{% url 'website:dashboard' %}"
        class="bg-[#015f73] text-[#FDEA00] px-6 py-2 rounded-full font-semibold hover:bg-[#014a5a] transition-colors shadow-lg w-fit my-8 cursor-pointer inline-block"
        hx-get="{% url 'website:dashboard' %}"
        hx-target="body"
        hx-swap="outerHTML"
      >
        Ir para o Painel
      </a>
      {% else %}
      <a
        href="{% url 'website:register' %}"
        class="bg-[#015f73] text-[#FDEA00] px-6 py-2 rounded-full font-semibold hover:bg-[#014a5a] transition-colors shadow-lg w-fit my-8 cursor-pointer inline-block"
      >
        Agende já
      </a>
      {% endif %}
    </div>
    
    <!-- Referral Section -->
    <div class="mt-6 relative z-10">
      <div class="flex items-center gap-3 justify-center lg:justify-start">
        <img
          src="{% static 'carla.webp' %}"
          alt="Cliente Carla"
          class="w-8 h-8 rounded-full object-cover"
        />
        <div>
          <div class="text-xs font-bold text-[#011E41] uppercase tracking-wider">
            REFIRA E GANHE CRÉDITO
          </div>
          <p class="text-xs text-[#4A5A70]">
            Partilhe-nos para ganhar descontos.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ───────────────  RIGHT: AUTO-SCROLL PROVIDER GRID  (≈65 %) ─────────────── -->
  <div
    class="row-start-1 col-start-1 w-full lg:w-[65%] flex flex-col px-8 lg:pr-16 z-0 lg:z-10"
  >
    <!-- Three equal columns that scroll independently -->
    <div class="grid grid-cols-3 gap-3 h-full opacity-60 lg:opacity-100">
      <!-- ===== COLUMN 1  – scrolls ↑  ===== -->
      <div
        class="h-[90vh] lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('up', 90000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-1 lg:space-y-2" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'carla.webp' %}"
                alt="Carla"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'orlando.webp' %}"
                alt="Orlando"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'juliana2.webp' %}"
                alt="Juliana"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'isabella.webp' %}"
                alt="Isabella"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'unknown1.webp' %}"
                alt="Service Provider"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'beatriz.webp' %}"
                alt="Beatriz"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>

      <!-- ===== COLUMN 2  – scrolls ↓  ===== -->
      <div
        class="h-[90vh] lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('down', 120000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-1 lg:space-y-2" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'victor.webp' %}"
                alt="Victor"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'juliana.webp' %}"
                alt="Juliana"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'pedro.webp' %}"
                alt="Pedro"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'raul.webp' %}"
                alt="Raul"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'nadia.webp' %}"
                alt="Nadia"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'carla.webp' %}"
                alt="Carla"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>

      <!-- ===== COLUMN 3  – scrolls ↑  ===== -->
      <div
        class="h-[90vh] lg:h-[300vh] overflow-hidden rounded-lg relative -z-10"
        x-data="scrollColumn('up', 150000)"
        x-init="start()"
      >
        <div x-ref="wrapper">
          <ul class="space-y-1 lg:space-y-2" x-ref="list">
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'raul.webp' %}"
                alt="Raul"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'nadia.webp' %}"
                alt="Nadia"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'beatriz.webp' %}"
                alt="Beatriz"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'orlando.webp' %}"
                alt="Orlando"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'victor.webp' %}"
                alt="Victor"
                class="object-cover w-full h-full"
              />
            </li>
            <li class="w-full h-72 rounded-lg overflow-hidden">
              <img
                src="{% static 'juliana.webp' %}"
                alt="Juliana"
                class="object-cover w-full h-full"
              />
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================  GRADIENT FADE OVERLAY  ======================== -->
  <!-- Gradient overlay at the bottom to fade out the photos -->
  <div
    class="absolute bottom-0 left-0 right-0 h-48 bg-[linear-gradient(to_top,_white_0%,_white_25%,_transparent_100%)] z-30 pointer-events-none"
  ></div>
</div>

<!-- ========================  SCRIPTS  ======================== -->
<script>
  /*
    scrollColumn(direction, duration)
      direction: 'up' | 'down'
      duration : milliseconds for one full loop
  */
  const scrollColumn = (direction = "up", duration = 30000) => ({
    _wrapper: null,
    _list: null,
    _listHeight: 0,
    _animationFrameId: null,

    start() {
      this._wrapper = this.$refs.wrapper;
      this._list = this.$refs.list;

      if (this._animationFrameId) {
        cancelAnimationFrame(this._animationFrameId);
      }

      // Defer execution to allow images to load and DOM to settle
      setTimeout(() => {
        this.setupAndRun();
      }, 100);
    },

    setupAndRun() {
      this._listHeight = this._list.offsetHeight;
      if (!this._listHeight) return;

      this.setupClones();

      const dir = direction === "up" ? -1 : 1;
      const isSmallScreen = window.innerWidth < 1024;
      const adjustedDuration = isSmallScreen ? duration * 1.5 : duration;
      const step = this._listHeight / (adjustedDuration / 16.67);

      let y;

      const currentTransform = window.getComputedStyle(this._wrapper).transform;
      if (currentTransform === "none") {
        y = 0;
      } else {
        y = new DOMMatrix(currentTransform).m42;
      }

      const animate = () => {
        y += dir * step;

        if (direction === "up") {
          if (y <= -this._listHeight) {
            y += this._listHeight;
          }
        } else {
          if (y >= 0) {
            y -= this._listHeight;
          }
        }

        this._wrapper.style.transform = `translateY(${y}px)`;
        this._animationFrameId = requestAnimationFrame(animate);
      };

      this._animationFrameId = requestAnimationFrame(animate);
    },

    setupClones() {
      // Clear any existing clones
      while (this._wrapper.children.length > 1) {
        this._wrapper.removeChild(this._wrapper.lastChild);
      }

      const containerHeight = this._wrapper.parentElement.offsetHeight;
      const cloneCount = Math.max(
        2,
        Math.ceil(containerHeight / this._listHeight) + 1
      );

      for (let i = 0; i < cloneCount; i++) {
        const clone = this._list.cloneNode(true);
        this._wrapper.appendChild(clone);
      }

      if (direction === "down") {
        // To scroll down seamlessly, we start with the list scrolled all the way to the end,
        // leaving one list-height's worth of content visible at the bottom for a smooth start.
        const totalHeight = this._wrapper.scrollHeight;
        this._wrapper.style.transform = `translateY(${
          -totalHeight + this._listHeight
        }px)`;
      }
    },
  });
</script>
